syntax = "proto3";

message RegionExtension {
  int32 regionId = 1;
}

message BirthdayExtension {
  int64 birthday = 1;
}

message VAGNumberExtension {
  string vag_number = 1;
}

message BavariaCardTypeExtension {
  BavariaCardType card_type = 1;
}

message Expiration {
  // Expiration day (calculated from 1970-01-01).
  // Cards are always invalid on 1970-01-01 (because day = 0 is excluded).
  // The calculated day is inclusive (e.g. if day == 1, then the card is valid on 1970-01-02, but not on 1970-01-03).
  // Because the data type is unsigned, there are no dates before 1970-01-01.
  // 2^32days = 11 759 230.8 years.
  uint32 day = 1;
}

// All fields in this extension are explicitly optional, handle with care!
message CardExtensions {
  RegionExtension extension_region = 1;
  BirthdayExtension extension_birthday = 2;
  VAGNumberExtension extension_vag_number = 3;
  BavariaCardTypeExtension extension_bavaria_card_type = 4;
}

message CardInfo {
  // Basic information
  string fullName = 1;
  Expiration expiration = 2;

  // Extensions
  CardExtensions extensions = 3;
}

message CardActivationCode {
  CardInfo info = 1;
  bytes hash_secret = 2;
  bytes totp_secret = 3;
}

message CardVerifyCode {
  CardInfo info = 1;
  bytes hash_secret = 2;
  int32 otp = 3;
}

// FIXME: Must be last because of https://github.com/protobufjs/protobuf.js/issues/1414
enum BavariaCardType {
  STANDARD = 0;
  GOLD = 1;
}
